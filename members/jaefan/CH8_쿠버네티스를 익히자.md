## SECTION 01. 쿠버네티스란?

### 쿠버네티스란?

- 쿠버네티스(Kubernetes, k8s)는 컨테이너 오케스트레이션(Orchestration) 도구
- 여러 개의 컨테이너를 지휘하는 도구

<aside>

    ❗ 컨테이너 오케스트레이션 (Container Orchestration)?

    오케스트레이션이란 여러 컴퓨터 시스템, 애플리케이션, 서비스 등을 조율하고 관리하는 것.

    컨테이너 오케스트레이션은 시스템 전체를 통괄하고 여러 개의 컨테이너를 관리하는 일 .

</aside>

**쿠버네티스를 일반적인 프로그래머가 관리하는 일은 드물다**

- 쿠버네티스는 여러 개의 컨테이너, 즉 서버를 관리하는 도구이기 때문에 그 본질상 일반적인 프로그래머가 사용할 일은 많지 않음
- 그럼 왜 배움? → 쿠버네티스로 관리되는 시스템은 이를 전제로 개발되어야 하기 때문

**쿠버네티스는 여러 대의 컨테이너가 여러 대의 물리적 서버에 걸쳐 실행되는 것을 전제로 함**

- 여러 대의 물리적 서버에 여러 대의 컨테이너를 실행하고 관리하기는 상당히 복잡하고 번거로움
- 쿠버네티스가 번거로운 컨테이너 생성이나 관리의 수고를 덜어줌
    - 도커 컴포즈에서 사용되는 컴포즈 파일과 비슷한 정의 파일 (manifest file)만 작성하면 이 정의에 따라 모든 물리적 서버에 컨테이너를 생성하고, 생성한 컨테이너를 관리 함

## SECTION 02. 마스터 노드와 워커 노드

### 클러스터의 구성 - 마스터 노드와 워커 노드

- 마스터 노드
    - 쿠버네티스의 전체적인 제어를 담당
    - 컨테이너 실행 x
    - 워커 노드에서 실행되는 컨테이너를 관리
    - 컨테이너 엔진 x
- 워커 노드
    - 실제 동작을 담당
    - 컨테이너가 실제 동작
    - 컨테이너 엔진 o

→ 마스터 노드와 워커 노드로 구성된 일군의 k8s 시스템을 **클러스터**라고 함 

- 클러스터는 사람이 개입없이 마스터 노드에 설정된 내용에 따라 워커 노드가 관리되며 자율적으로 동작

<aside>

    ❗마스터 노드와 워커 노드 

    분산 처리 시스템에서 작업을 분배하는 마스터 노드와 실제 작업(데이터)을 처리하는 워커 노드 개념과 일치하는 듯 하다.

</aside>

**쿠버네티스를 사용하려면 먼저 설치가 필요** 

- 쿠버네티스는 도커 엔진 등의 컨테이너 엔진과는 별개의 소프트웨어
- 마스터 노드에는 컨테이너 등의 상태 관리를 위한 etcd 데이터베이스가 설치
- 마스터 노드를 설정하는 관리자 컴퓨터에는 kubectl 필요

**컨트롤 플레인(제어판)과 kube-let**

- 마스터 노드는 **컨트롤 플레인**을 통해 워커 노드를 관리
    - 마스터 노드 측 컨트롤 플레인 구성
        
        
        | 항목  | 내용 |
        | --- | --- |
        | kube-apiserver | 외부와 통신하는 프로세스, kubectl로부터 명령을 전달받아 실행  |
        | kube-controller-manager | 컨트롤러를 통합 관리, 실행  |
        | kube-scheduler | 파드(pod)를 워커 노드에 전달  |
        | cloud-controller-manager | 클라우드 서비스와 연동해 서비스를 생성 |
        | etcd | 클러스터 관련 정보 전반을 관리하는 DB |
- 워커 노드에서는 kube-let과 kube-proxy가 동작
    - 워커 노드 구성
        
        
        | 항목 | 내용 |
        | --- | --- |
        | kube-let | 마스터 노드에 있는 kube-scheduler와 연동하며 워커 노드에 파드를 배치하고 실행한다. 또 실행 중인 파드의 상태를 정기적으로 모니터링하며 kube-scheduler에 통지한다. |
        | kube-proxy | 네트워크 통신의 라우팅 메커니즘  |

### 쿠버네티스는 항상 ‘바람직한’ 상태를 유지

- 쿠버네티스는 ‘컨테이너는 OO개, 볼륨은 XX개로 구성하라’ 와 같이 어떤 ‘바람직한 상태’를 YAML 파일에 정의하고, 정의한 바람직한 상태를 만들고 유지하는 것을 기본적인 아이디어로 함
- 도커 컴포즈와의 차이
    - 도커 컴포즈는 모니터링 기능이 존재하지 않아 컨테이너를 만들 때 이외에는 해당 시스템에 관여하지 않음
    - 하지만, k8s는 해당 ‘**상태를 유지**’하는 기능이 있음

**쿠버네티스를 사용하는 시스템에서 컨테이너 삭제** 

- 쿠버네티스가 관리하는 시스템에서 컨테이너를 삭제하고 싶다면, 정의 파일의 **바람직한 상태를 수정**해야 함
- 쿠버네티스의 목표는 ‘**바람직한 상태를 유지하는 것**’이기 때문에, 사람이 임의로 개입해서 컨테이너를 삭제해서는 안됨

<aside>

    ❗ 로드 밸런서와 클라우드 컴퓨팅 

    로드 밸런싱 (Load Balancing)이란 한 대의 서버에 모든 요청이 집중되지 않도록 여러 대의 서버를 갖추고 요청을 각 서버에 분산하는 것을 말하며, 
    이 분산 작업을 하는 장치가 로드 밸런서이다.

    하지만, 서버에 들어오는 요청은 정해져 있지 않기 때문에 서버의 scale-in/out이 용이하다면 서버 비용을 줄일 수 있다. 
    이러한 기능을 제공해주는 것이 AWS, GCP, Azure와 같은 클라우드 컴퓨팅 서비스이다. 

</aside>

## SECTION 03. 쿠버네티스의 구성과 관련 용어

### 파드, 서비스, 디플로이먼드, 레플리카세트

- 쿠버네티스에서 컨테이너는 파드(pod)라는 단위로 관리 됨

→ **쿠버네티스에서 배포되고 관리되는 최소 단위** 

- **파드(Pod)**: 컨테이너와 볼륨을 함께 묶은 것
    - 기본적으로 하나의 파드에 하나의 컨테이너(1:1 Pod-Container Model),
    예외도 있음 (멀티 컨테이너 파드)
    - 파드에 포함되는 볼륨은 파드에 포함되는 컨테이너가 정보를 공유하기 위해 사용하는 것
    - 볼륨은 파드에서 필수 구성 요소가 아님
- **서비스(Service)**: 여러 개의 파드가 모아져 있는 것 (추상적?)
    - 여러 개의 파드를 이끄는 반장
    - 서비스가 관리하는 파드는 모두 기본적으로 동일한 구성
    - 구성이 다른 파드는 별도의 서비스로 관리
    - 서비스의 역할은 로드 밸런서
    - 각 서비스는 자동적으로 고정 IP(cluster IP)를 부여 받으며, 이 주소로 들어오는 통신을 처리
    - 서비스가 분배하는 통신은 하나의 워커 노드(하나의 물리 서버)로 국한
- **레플리카세트(ReplicaSet)**: 파드의 수를 관리하는 컨트롤러
    - 여러가지 이유로 파드가 종료되어 파드가 부족하거나, 정의 파일에 정의된 파드의 수가 감소하는 경우 파드를 보충하거나 감소시킴
        
        → 레플리카 수를 조정 / 결정 
        
    - 서비스와 함께 파드를 관리하는 반장 중 하나
    - 레플리카세트가 관리하는 동일한 구성의 파드를 레플리카(Replica)라고 함
    - 일반적으로 디플로이먼트와 함께 사용 됨
- **디플로이먼트(Deployment):** 파드의 배포를 관리
    - 파드가 사용하는 이미지 등 파드에 대한 정보를 보유
    - 레플리카세트를 생성하고 관리하는 상위 개념
    - 레플리카세트가 제공하지 않는 배포 자동화, 롤백, 롤링 업데이트와 같은 고급 기능 제공

### 그 외 리소스

- 앞서 살펴 본 Pod, Service, ReplicaSet, Deployment 등을 리소스(resource)라고 함
- k8s에는 50개 이상의 리소스가 있는데, 맛보는 단계에서는 위에서 소개한 4개만 알아도 충분

</br>

<aside>

    ❗ 오브젝트와 인스턴스 

    Pod, Service, ReplicaSet, Deployment 등을 각각 ‘OO 오브젝트(object)’라고 부르기도 한다.

    이유는 위와 같은 리소스가 마스터 노드에 위치한 etcd 데이터베이스에서 ‘OO 오브젝트’ 형태로 관리되기 때문이다.

    쿠버네티스의 정의 파일 내용은 etcd 데이터베이스에 등록되어 관리된다. 

    쿠버네티스는 etcd에 등록된 내용을 바탕으로 실제 Pod 혹은 Service 를 생성하며, 이렇게 생성된 것을 인스턴스(Instance)라고 한다. 

    정리하자면, etcd(DB)에 저장된 오브젝트 정보를 바탕으로 생성된 것을 인스턴스라고 하며, 실제로 동작하는 것은 인스턴스이다. (클래스-객체 비슷한 듯)

</aside>